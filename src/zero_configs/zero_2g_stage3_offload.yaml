# ZeRO-3 + CPU offload (useful even on 1 GPU; also handy on tight VRAM)
train_micro_batch_size_per_gpu: 16
gradient_accumulation_steps: 1
bf16:
  enabled: true
fp16:
  enabled: false

zero_optimization:
  stage: 3
  overlap_comm: true
  contiguous_gradients: true
  reduce_scatter: true
  stage3_max_live_parameters: 1e9
  stage3_max_reuse_distance: 1e9
  stage3_param_persistence_threshold: 1e5
  reduce_bucket_size: 50000000
  allgather_bucket_size: 50000000

  # offload both params and optimizer states to CPU and pin for speed (prevents paging out and allows direct memory access from GPU)
  offload_param:
    device: cpu
    pin_memory: true
  offload_optimizer:
    device: cpu
    pin_memory: true

gradient_clipping: 1.0
wall_clock_breakdown: true

# activation_checkpointing:
#   partition_activations: true
#   contiguous_memory_optimization: true
#   cpu_checkpointing: false

